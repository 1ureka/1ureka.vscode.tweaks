# 1ureka's VSCode Extension

個人使用的 VSCode 擴充套件，整合多種實用功能。

## 主要功能

### 圖片檢視器

- 設計用來取代 VSCode 預設圖片編輯器
- 支援滑鼠/觸控板縮放、平移、慣性滾動
- 右鍵選單可快速重設視角
- 內建吸管工具，一鍵取色並複製
- 右鍵選單提供 "導出為..." 選項，可將圖片另存為其他格式
- 導出完成後，使用者可以點擊通知中的 "開啟檔案" 快速比較差異

### 圖片牆

- 右鍵資料夾「以圖片牆顯示」，或使用命令面板「開啟圖片牆」瀏覽任意位置的圖片
- 提供三種布局模式（標準、編織、磚牆）和三種尺寸（小、中、大），可在右鍵選單即時切換
- 預設智慧瀑布流佈局（磚牆模式），完美適應當資料夾中有各種尺寸圖片時的情況
- 響應式設計，無論面板如何分割或調整大小，都能正確排版並顯示圖片
- 漸進式載入機制，先快速掃描所有圖片的元資料，顯示骨架與排版，確保初始畫面無閃爍
- 自動壓縮圖片，經過測試在 50 張圖片且每張圖片都超過 50MB 也能高效顯示且不影響滾動體驗
- 分頁機制與快速元資料讀取，支援上達數千張圖片的資料夾
- 點擊圖片即可在圖片檢視器中開啟

### 圖片剪貼簿

- 完整實作上述功能的剪貼簿操作，避免由於 VSCode 原生選單中的複製選項無法刪除，造成誤導
- 在圖片檢視器右鍵選單有複製該張圖片的選項
- 在圖片牆右鍵任一圖片的選單中也有複製該張圖片的選項
- 在 Windows 系統上，複製與剪下的是圖片本身而非路徑
- 該功能甚至支援 Windows 原生無法處理的 WebP、TIFF 等格式寫入剪貼簿
- 複製大型圖片時顯示實時進度，提供即時回饋

### 檔案元資料顯示

- 狀態列自動顯示當前檔案的建立時間、修改時間、大小等資訊
- 支援所有檔案類型，甚至包括 VsCode 原生無法開啟的任意二進位檔
- 適合管理包含非程式碼檔案的專案
- 針對圖片檔案提供特殊 UI，額外顯示解析度、長寬比、格式、色彩空間、通道等資訊

### 檔案系統瀏覽器

- 右鍵資料夾「以檔案系統瀏覽器顯示」，或使用命令面板「開啟檔案系統瀏覽器」瀏覽任意位置的檔案
- 目前已經實現完整路由，包括瀏覽資料夾、回到上層、麵包屑導航等，更多功能正在開發中
<!-- - 類似作業系統的檔案總管，但使用仿雲端硬碟的現代化介面，目標是再也不需要打開系統檔案總管 -->
<!-- - 讓 VsCode 能夠更輕鬆的與外部互動，比如將下載資料夾中的檔案移動到工作區中 -->
<!-- - 在 VsCode 對於工作區的樹狀檢視、快速理解資料結構的基礎上，提供更靈活的本地操作能力 -->

<!-- ### 檔案系統瀏覽器操作區 -->
<!-- - 檔案系統瀏覽器最上方有對於所在目錄的操作區 -->
<!-- - 提供常用的檔案操作按鈕（新增資料夾、新增檔案、重新命名等） -->
<!-- - 「以圖片牆開啟」與插件其他部分功能的整合 -->
<!-- - 「在此開啟新工作區」對傳統流程的優化，當需要切換工作區時，不再需要叫出系統檔案總管 -->
<!-- - 「在此開啟終端機」在終端機面板開啟一個當前路徑的終端機實例 -->

### 自訂樣式注入

- 比起 `Custom JS and CSS Loader` 能更安全注入自訂 CSS 到 VSCode 介面
- 透過採用修改而非刪除 CSP 的策略，通過安全完整性檢查
- 以及建構插件時將 CSS 內聯為字串，消除執行時的檔案 I/O 也減少了安全風險

### 外部應用程式整合 (Windows)

- 右鍵 `.blend` 檔案快速以裝置中最新的 Blender 開啟
- 右鍵 `.spp` 檔案快速以裝置中最新的 Substance Painter 開啟
- 命令選擇區也可直接啟動 Substance Painter 或 Blender
- 若應用位置特殊或想指定版本，可在 VsCode 設定中自訂路徑

## 架構設計

本擴充套件採用 **Commands / Providers / Handlers / Webview** 四層架構。

### 後端架構（延伸主機）

#### Commands 層

- **職責：** 命令註冊與生命週期管理
- 使用 `vscode.commands.registerCommand` 註冊命令
- 管理 Webview Panel/Editor 的生命週期
- 處理使用者輸入驗證（如檔案選擇對話框）
- 負責呼叫 Providers 層的功能

#### Providers 層

- **職責：** 延伸主機操作 VS Code 介面
- **注意：** 這裡的 "Providers" 是廣義概念，不限於 VS Code 的 `Provider` API（如 TreeDataProvider、CompletionItemProvider 等），而是指所有「延伸主機操作介面」的邏輯
- 建立與管理 Webview Panel 和 Custom Editor
- 操作 StatusBar 等 UI 元件
- 處理 Webview 與延伸主機之間的訊息通訊
- 協調 Handlers 層處理業務邏輯

#### Handlers 層

- **職責：** 純業務邏輯處理
- 資料準備與轉換
- 圖片處理、檔案操作等核心功能
- 不依賴 VS Code API（除了基本的進度/錯誤提示）
- 可獨立測試的功能單元

### 前端架構（Webview）

#### Webview 層

- **職責：** 使用者介面呈現與互動
- 使用 React + Material-UI 構建 UI 元件
- 採用 Zustand 可在 React 外部更新的特性，銜接後端與前端的資料狀態
- 利用 `var(--vscode-theme-*)` CSS 變數一開始就會被 VsCode 注入的特性，實現 MUI 主題自動同步
- 將使用者互動事件透過 `vscodeApi.postMessage` 傳送給延伸主機
- 延伸主機透過 Providers 層的路由機制將訊息傳遞給 Handlers 層處理
- 若有回傳需求，則會透過 Zustand 在外部更新，並觸發 React 元件重新渲染，盡量避免使用 useEffect

### 資料流向

#### 初始化階段

```
使用者觸發命令
    ↓
Commands (驗證、呼叫 Provider)
    ↓
Providers (呼叫 Handler 準備初始資料)
    ↓
Handlers (讀取檔案、處理資料)
    ↓
Providers (將 initialData 序列化並注入 HTML <script id="__data__">)
    ↓
Webview 載入時立即讀取 initialData (無需等待 postMessage)
    ↓
React 元件直接使用資料進行初次渲染（類似 SSR，避免閃爍）
```

#### 後續互動階段

```
使用者在 Webview 中互動（點擊、換頁等）
    ↓
vscodeApi.postMessage (傳送事件請求)
    ↓
Providers (onDidReceiveMessage 接收並驗證訊息)
    ↓
Handlers (處理業務邏輯)
    ↓
Providers (透過 webview.postMessage 回傳結果)
    ↓
Webview 監聽 message 事件
    ↓
Zustand 更新狀態（在 registerXxxEvent 中）
    ↓
React 元件自動重新渲染
```

---

作者：1ureka | 版本：0.2.1
